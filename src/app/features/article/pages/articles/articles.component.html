<hlm-toaster />

<div class="w-full flex justify-center px-4 py-8">
  <div class="w-full max-w-4xl">
    <div class="bg-card rounded-2xl shadow-lg border border-border p-8">
      <h2 class="text-2xl font-bold text-foreground mb-6 text-center">
        Search News Articles
      </h2>

      <form [formGroup]="form" class="space-y-6">
        <!-- Search Input -->
        <div class="space-y-2">
          <div class="text-sm font-medium text-muted-foreground">
            Search Query
          </div>
          <input
            class="w-full"
            hlmInput
            data-cy="form-input-query"
            placeholder="Enter keywords to search..."
            formControlName="q" />
        </div>

        <!-- Date and Sort Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Date Picker -->
          <div class="space-y-2">
            <div class="text-sm font-medium text-muted-foreground">
              From Date
            </div>
            <hlm-date-picker
              formControlName="from"
              [autoCloseOnSelect]="true"
              data-cy="form-input-date"
              class="w-full">
              <span>Pick a date</span>
            </hlm-date-picker>
          </div>

          <!-- Sort By -->
          <div class="space-y-2">
            <div class="text-sm font-medium text-muted-foreground">Sort By</div>
            <brn-select
              class="w-full"
              placeholder="Select sorting option"
              formControlName="sortBy"
              data-cy="form-input-sort">
              <hlm-select-trigger class="w-full">
                <hlm-select-value />
              </hlm-select-trigger>
              <hlm-select-content>
                @for (sortByOption of sortByOptions; track $index) {
                  <hlm-option [value]="sortByOption">
                    {{ sortByOption | titlecase }}
                  </hlm-option>
                }
              </hlm-select-content>
            </brn-select>
          </div>
        </div>

        <!-- Search Button -->
        <div class="flex justify-center pt-2">
          <button
            hlmBtn
            (click)="onSearch()"
            data-cy="form-submit-button"
            class="w-full md:w-auto px-12 py-6 text-base font-semibold">
            Search Articles
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="w-full flex md:px-16 lg:px-24">
  <div
    class="w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-5 px-4">
    @if (isLoading()) {
      @for (_ of [1, 2, 3, 4, 5, 6]; track $index) {
        <!-- Skeleton Card -->
        <div
          class="flex flex-col overflow-hidden rounded-2xl bg-card border border-border shadow-sm h-full">
          <!-- Skeleton Image -->
          <hlm-skeleton class="w-full aspect-video rounded-none" />

          <!-- Skeleton Content -->
          <div class="flex flex-col flex-1 p-5 space-y-3">
            <!-- Skeleton Title Lines -->
            <div class="space-y-2">
              <hlm-skeleton class="h-4 w-full" />
              <hlm-skeleton class="h-4 w-4/5" />
              <hlm-skeleton class="h-4 w-3/4" />
            </div>

            <!-- Spacer -->
            <div class="flex-1"></div>

            <!-- Skeleton Footer -->
            <div
              class="flex items-center justify-between pt-3 border-t border-border">
              <hlm-skeleton class="h-3 w-24" />
              <hlm-skeleton class="h-3 w-16" />
            </div>
          </div>
        </div>
      }
    } @else {
      @for (article of articles(); track $index) {
        <app-article [article]="article" />
      }
    }
  </div>
</div>

<div class="w-full flex items-center justify-center mt-8">
  <hlm-numbered-pagination-query-params
    [(currentPage)]="currentPage"
    [(itemsPerPage)]="itemsPerPage"
    [totalItems]="totalItems()"
    [pageSizes]="pageSizeOptions"
    [maxSize]="7"
    [showEdges]="true" />
</div>
